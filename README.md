# Intraday Trading Bot (T-Invest)

Простой внутридневной торговый бот для акций РФ.

**Особенности:**
- рынок: акции РФ (MOEX)
- брокер: T-Invest (Invest API)
- стратегия: intraday mean reversion (возврат к VWAP)
- режим: пулл минутных свечей (1m)
- лонг-онли, без плеча
- жёсткий риск-менеджмент и дневной лимит убытка
- предназначен для запуска локально (Windows / macOS / Linux)

---

## Структура проекта

```text
.
├── main.py                 # основной цикл
├── broker.py               # работа с Invest API (заявки, позиции, данные)
├── strategy.py             # логика входа/выхода (тейк/стоп/тайм-стоп)
├── risk.py                 # риск-менеджмент и дневные лимиты
├── state.py                # состояние позиций и заявок
├── config.yaml.example     # шаблон конфига (копировать в config.yaml)
├── requirements.txt
├── logs/
│   └── .gitkeep
└── README.md
```

## Быстрый старт (Windows)
1️⃣ Подготовка окружения

Установи Python 3.10+

Проверь:
```text
python --version
pip --version
```

2️⃣ Установка зависимостей
```text
pip install -r requirements.txt
```

3️⃣ Настройка API-токена

В PowerShell один раз:
```text
setx INVEST_TOKEN "ТВОЙ_API_ТОКЕН_T_INVEST"
```

Закрой PowerShell, открой заново и проверь:
```text
echo $env:INVEST_TOKEN
```

⚠️ Никогда не добавляй токен в код или конфиг.

4️⃣ Конфигурация

Скопируй шаблон:
```text
copy config.yaml.example config.yaml
```

По умолчанию:
- используется sandbox
- торговля начинается после открытия рынка
- позиции не переносятся через ночь

5️⃣ Запуск
```text
python main.py
```

Остановка:
```text
Ctrl + C
```

## Sandbox и боевой режим

По умолчанию в config.yaml:
```text
broker:
  use_sandbox: true
```

➡️ РЕКОМЕНДУЕТСЯ:
1. Прогнать бота 2–3 торговых дня в sandbox
2. Проверить логи (logs/bot.log)
3. Только потом переключать:
broker:
  use_sandbox: false

## Как работает стратегия (кратко)
- вход: отклонение цены вниз от VWAP на k * ATR
- выход:
-- тейк-профит
-- стоп-лосс
-- тайм-стоп
- только лимитные заявки
- не более заданного числа сделок в день
- дневной лимит убытка блокирует торговлю до следующего дня

## Логи и контроль
- все действия пишутся в logs/bot.log
- для штатной работы достаточно 15–20 минут контроля в день
